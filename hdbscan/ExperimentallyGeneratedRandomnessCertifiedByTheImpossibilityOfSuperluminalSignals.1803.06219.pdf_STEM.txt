


















































experiment gener random certifi by 
the imposs of superlumin signal 

peter bierhorst,1∗ emanuel knill,1,6 scott glancy,1 yanbao zhang,1† 

alan mink,2,3 stephen jordan,2 andrea rommal,4 yi-kai liu,2 

bradley christensen,5 sae woo nam,1 martin J. stevens,1 lynden K. shalm1 

1nation institut of standard and technology, boulder 80305, co, usa 
2 nation institut of standard and technology, gaithersburg 20899, md, usa 

3 theiss research, La jolla, ca, 92037, usa 
4 muhlenberg college, allentown, pa, 18104, usa 

5 depart of physics, univers of wisconsin, madison, wi, 53706, usa 
6center for theori of quantum matter, univers of colorado, boulder, colorado 80309, usa 
†present address: ntt basic research laboratori and ntt research center for theoret 

quantum physics, ntt corporation, 3-1 morinosato-wakamiya, atsugi, kanagawa 243-0198, japan 
∗ e-mail: peter.bierhorst@nist.gov 

from dice to modern complex circuits, there have be mani attempt to build increas- 
ingli good devic to gener random numbers. today, random be fundament to 
secur and cryptograph systems, a well a safeguard privacy. A key challeng 
with random number gener be that it be hard to ensur that their output be unpre- 
dictabl [1–3]. for a random number gener base on a physic process, such a a 
noisi classic system or an elementari quantum measurement, a detail model describ- 
ing the underli physic be requir to assert unpredictability. such a model must make 
a number of assumpt that may not be valid, therebi compromis the integr of the 
device. however, it be possibl to exploit the phenomenon of quantum nonloc with a 
loophole-fre bell test to build a random number gener that can produc output that 
be unpredict to ani adversari limit onli by gener physic principl [1–11]. with 
recent technolog developments, it be now possibl to carri out such a loophole-fre bell 
test [12–14]. here we present certifi random obtain from a photon bell experi- 
ment and extract 1024 random bit uniform to within 10−12. these random bit could not 
have be predict within ani physic theori that prohibit superlumin signal and 
allow one to make independ measur choices. To certifi and quantifi the ran- 

1 

ar 
X 

iv 
:1 

80 
3. 

06 
21 

9v 
1 

[ 
qu 

an 
t- 

ph 
] 

2 
2 

Fe 
b 

20 
18 



domness, we describ a new protocol that be optim for apparatu character by 
a low per-trial violat of bell inequalities. We thu enlist an experiment result that 
fundament challeng the notion of determin to build a system that can increas 
trust in random sources. In the future, random number gener base on loophole- 
free bell test may play a role in increas the secur and trust of our cryptograph 
system and infrastructure. 

the search for certifi unpredict random number gener be motiv by appli- 
cations, such a secur communication, for which the predict of pseudorandom string 
make them unsuitable. privat random be requir to initi and authent virtual everi 
secur commun [15], and public random from random beacon can be use for 
public certif and resourc distribut in mani set [16]. To certifi randomness, one 
can perform an experi know a a bell test [17], which in it simplest form perform mea- 
surement on an entangl system locat in two physic separ measur stations, 
with each station choos between two type of measurements. after multipl experiment 
trial with vari measur choices, if the measur data violat condit know a 
“bell inequalities,” then the data can be certifi to contain random under weak assump- 
tions. 

our random gener employ a “loophole-free” bell test, which notabl be character- 
ize by high detect effici and space-lik separ of the measur station dure 
each experiment trial. the bit be unpredict assum that (1) the choic of measure- 
ment set be independ of the experiment devic and pre-exist classic informa- 
tion about them and (2) in each experiment trial, the measur outcom at each station 
be independ of the set choic at the other station. the first assumpt be ultim 
untestable, but the premis that it be possibl to choos measur set independ of 
a system be measur be often tacitli invok in the interpret of mani scientif exper- 
iment and law of physic [18]. the second assumpt can onli be violat if one admit a 
theori that permit send signal faster than the speed of light, give our trust that the space- 
like separ of the relev event in the experi be accur verifi by the time 
electron and that result be final when recorded. We also trust that the classic comput 
equip use to process the data oper accord to specification. 

under the abov assumptions, the output random be certifi to be unpredict with 
respect to a real or hypothet actor “eve” in possess of the pre-exist classic informa- 
tion, physic isol from the devic while they be under our control, and without access 
to data produc dure the protocol. the bit remain unpredict to eve if she learn the set- 
ting at ani time after her last interact with the devices. If the devic be trusted, which be 
reason if we built them, then thi may be well befor the start of the protocol, in which case 
the set can come from public random [2,10]. In particular, one can use an exist pub- 
lic random source, such a the nist random beacon [16], to gener much need privat 
random a output. sinc the assumpt do not constrain the specif physic realiz 
of the devic and do not requir specif state or measurements, they implement a “device- 
independent” framework [19] which allow an individu user to assur secur with minim 

2 



assumpt about the devices. If eve have quantum memory, it be possibl to ensur that eve’ 
side inform be effect classic by verifi that the devic have no long-term quantum 
memori of past interact with eve. while thi introduc weak device-dependence, for the 
forese futur thi verif task be compar to that requir to enforc the absenc of 
commun from the devic to eve. 

the onli previou experiment product of certifi random from bell test data be 
report in the ground-break paper by pironio et al. [5]. their bell test be implement 
with ion in two separ ion-traps, close the detect loophol [20] but without space-lik 
separation. indeed, bell test achiev space-lik separ without other experiment loop- 
hole have be perform onli recent [12–14, 21]. under more restrict assumpt than 
ours, the maximum amount of random in principl avail in the data of pironio et al. 
be quantifi a 42 bit with an error paramet of 0.01, but they do not extract a uniformli 
distribut bit string from their data. pironio et al. argu that ani interact between measure- 
ment station in their experi be negligible, becaus they be locat in separ ion-traps, 
each in it own vacuum chamber. however, ani shield between the station be necessarili 
incomplete; for exampl they must have an open quantum channel to establish entanglement. 
mundan physic effect can allow local-realist system to appear to violat bell inequal- 
iti when shield be incomplete. reli instead on the imposs of faster-than-light 
commun provid strong assur of the unpredict of the randomness. 

We gener random use an improv version of the loophole-fre bell test report 
in ref. [13]. five new data set be collected, with the best-perform data set yield 1024 
new random bit uniform to within 10−12. We also obtain 256 random bit from the main data 
set analyz in ref. [13], albeit onli uniform to within 0.02. the experiment, illustr in fig. 
1, consist of a sourc of entangl photon and two measur station name “alice” and 
“bob”. dure an experiment trial, at each station a random choic be make between two 
measur set label 0 and 1, after which a measur outcom of detect (+) or 
nondetect (0) be recorded. each station’ implement of the measur set be 
space-lik separ from the other station’ measur event, and no postselect be em- 
ploy in collect the data. see the method section for details. for trial i, we model alice’ 
set choic with the random variabl Xi and bob’ with yi, both of which take valu in 
the set {0, 1}. alice’ and bob’ measur outcom random variabl be respect Ai 
and bi, both of which take valu in the set {+, 0}. when refer to a gener singl trial, we 
omit indices. with thi notation, a gener bell inequ for our scenario can be express in 
the form [22] ∑ 

abxi 

sabxyp(a = a,b = b|x = x, Y = y) ≤ β, (1) 

where the sabxi be fix real coeffici index by a, b, x, y that rang over all possibl valu 
of a,b,x, Y . the upper bound β be requir to be satisfi whenev the settings-condit 
outcom probabl be induc by a model satisfi “local realism” (lr). LR distributions, 
which cannot be certifi to contain randomness, be those for which p(a = a,b = b|x = 
x, Y = y) be of the form 

∑ 
λ p(a = a|x = x,λ = λ)p(b = b|i = y,λ = λ)p(λ = λ) for 

3 



a random variabl Λ repres local hidden variables. the bell inequ be non-trivi if 
there exist a quantum-realiz distribut that can violat the bound β. 

It have long be know that experiment violat of bell inequ such a eq. 1 indi- 
cate the presenc of random in the data. To quantifi random with respect to eve, we 
repres eve’ initi classic inform by a random variabl E. We formal the assump- 
tion that measur set can be gener independ of the system be measur 
and eve’ inform with the follow condition: 

p(xi = x, Yi = y|e = e, pasti) = p(xi = x, Yi = y) = 
1 

4 
∀x, y, e, (2) 

where pasti repres event in the past of the i’th trial, specif includ the trial set 
and outcom for trial 1 through i − 1. our other assumption, that measur outcom be 
independ of remot measur choices, be formal a follows: 

p(ai = a|xi = x, Yi = y, E = e, pasti) = p(ai = a|xi = x,e = e, pasti) 
p(bi = b|xi = x, Yi = y, E = e, pasti) = p(bi = b|yi = y, E = e, pasti) ∀x, y, e. (3) 

these equat be commonli refer to a the “non-signaling” assumptions, although they 
be often state without the condit E and pasti. our space-lik separ of set and 
remot measur provid assur that the experi obey eqs. 3. We remark that if one 
assum the measur system obey quantum physics, strong constraint be possibl [23,24]. 

given eqs. 2 and 3, our protocol produc random bit in two sequenti parts. for the first 
part, “entropi production”, we implement n trial of the bell test, from which we comput a 
statist V relat to a bell inequ (eq. 1). V quantifi the bell violat and determin 
whether or not the protocol pass or aborts. If the protocol passes, we certifi an amount of 
random in the outcom string even condit on the set string and E. In the second 
part, “extraction,” we process the outcom string into a shorter string of bit whose distribut 
be close to uniform. We use our custom implement of the trevisan extractor [25] 
deriv from the framework of mauerer, portmann and scholz [26] and the associ open 
sourc code. We call thi the tmp algorithm, see supplementari inform (si) s.4 for 
details. 

We appli a new method of certifi the amount of random in bell tests. previou 
method for relat model with variou set of assumpt [2–8, 27–29] be ineffect in 
our experiment regim (si s.7), which be character by a small per-trial violat of bell 
inequalities. other recent work that explor how to effect certifi random from a wider 
rang of experiment regim assum that measur state be independ and ident 
distribut (i.i.d.) or that the regim be asymptot [9–11, 30]. our method, which do not 
requir these assumptions, build on the prediction-bas ratio (pbr) method for reject LR 
[31]. appli thi method to train data (see below), we obtain a real-valu “bell function” 
T with argument a,b,x, Y that satisfi T (a,b,x, Y ) > 0 with expect e(t ) ≤ 1 
for ani LR distribut satisfi eq. 2. from T we determin the maximum valu 1 + m 

4 



of e(t ) over all distribut satisfi eqs. 2 and 3, where we requir that m > 0. such 
a function T induc a bell inequ (eq. 1) with β = 4 and sabxi = T (a, b, x, y). defin 
Ti = T (ai, bi, xi, yi) and V = 

∏n 
i=1 ti. If the experiment observ a valu of V larg than 

1, thi indic a violat of the bell inequ and the presenc of random in the data. 
the random be quantifi by the follow theorem, proven in the SI s.2. below, we denot 
all of the set of both station with XY = x1y1x2y2...xnyn, and other sequenc such a 
AB and abxi be similarli interleav over n trials. 

entropi product theorem. suppos T be a bell function satisfi the abov conditions. 
then in an experi of n trial obey eqs. 2 and 3, the follow inequ hold for all 
�p ∈ (0, 1) and vthresh satisfi 1 ≤ vthresh ≤ (1 + (3/2)m)n�−1p : 

Pe (pe(ab|xy) > δ and V ≥ vthresh) ≤ �p (4) 

where δ = [1+(1− n√�pvthresh)/(2m)]n and Pe denot the probabl distribut condit 
on the event {E = e}, where e be arbitrary. the express pe(ab|xy) denot the random 
variabl that take the valu pe(ab = ab|xi = xy) when abxi take the valu abxy. 

In words, the theorem say that with high probability, if V be at least a larg a vthresh, then the 
output AB be unpredictable, in the sens that no individu outcom {ab = ab} occur with 
probabl high than δ, even give the inform {xye = xye}. the theorem support a 
protocol that abort if V take a valu less than vthresh, and pass otherwise. If the probabl 
of pass be 1, then − log2(δ) would be a so-cal “smooth min-entropy”, a quantiti that 
character the number of uniform bit of random that be in principl avail in AB 
[32, 33]. We show in the SI s.3 that for constant �p, − log2(δ) be proport to the number 
of trials. how mani bit we can actual extract depend on �fin, the final output’ maximum 
allow distanc from uniform. We also show in the SI that the entropi product theorem 
can still be prove if eq. 2 be weaken so that set probabl need not be know but be 
constrain to be within α of 1/4 with α < 1/4, while still be condit independ 
of earli outcom give earli settings. such a weaken be relev for experi [12– 
14] that use physic random number gener to choos the settings, for which the set 
probabl cannot be know exactly. 

To extract the avail random in ab, we use the tmp algorithm to obtain an extrac- 
tor, specif a function ext that take a input the string AB and a length d “seed” bit string 
S, where S be uniform and independ of abxy. it output be a length t bit string. S can be 
obtain from d addit instanc of the random variabl xi, so eq. 2 ensur the need 
independ and uniform condit on S. In order for the output to be within a distanc �fin 
of uniform independ of XY and E, the entropi product and extractor paramet must 
satisfi the constraint give in the next theorem, proven in the SI s.5. In the statement of the 
theorem, the measur of distanc use be the “total variat (tv) distance,” express by the 
left side of eq. 6, and “pass” be the event that V exce vthresh. 

5 



protocol sound theorem. let 0 < �ext, κ < 1. suppos that p(pass) ≥ κ and suppos that 
that the protocol paramet satisfi 

t+ 4 log2 t ≤ − log2 δ + log2 κ+ 5 log2 �ext − 11. (5) 

then the output U = ext(ab,s) of the function obtain by the tmp algorithm satisfi 

1 

2 

∑ 
u,xys 

∣∣∣p(u = u,xys = xyse|pass)−punif(u = u)p(xy = xye|pass)punif( = s)∣∣∣ 
≤ �p/p(pass) + �ext, (6) 

where punif denot the uniform probabl distribution. 

the number of seed bit d requir satisfi d = o(log(t) log(nt/�ext)2), and SI s.4 give an 
explicit bound. 

the theorem provid sever option for quantifi the uniform of the random pro- 
duced. A goal be for the protocol to be nearli indistinguish accord to TV distanc from 
an ideal protocol, where in an ideal protocol the random be perfectli uniform condit on 
passing. for this, the ideal protocol can be chosen to have the same probabl of pass with 
behavior match that of the real protocol when aborting. the theorem impli that the uncon- 
dition distribut of the protocol be within TV distanc max(�p + �ext, κ) of that of an ideal 
protocol (si s.5). for thi distance, if the probabl of pass be compar to κ, then the 
condit TV distanc from uniform, give in eq. 6, could be large. It be desir that even 
for the bad case probabl of passing, the condit TV distanc be small. accordingly, we 
quantifi the uniform for our implement with �fin = max(�p/κ + �ext, κ). then, for ani 
probabl of pass great than �fin, condit on passing, the TV distanc from uniform 
be at most �fin. 

We appli our protocol to five data set use the setup base on that describ in ref. [13] 
with improv describ in the method section. each data set be collect in five to ten 
minutes, improv on the approxim one month durat of data acquisit report in 
ref. [5]. befor start the protocol, we set asid the first 5 × 106 trial of each data set a 
train data, which we use to choos paramet need by the protocol. with the train 
data removed, the number n of trial use by the protocol be between 2.5× 107 and 5.5× 107 
for each data set. We use the train data to determin a bell function T with statist 
strong violat of LR on the train data accord to the pbr method [31]; see SI s.3. 
the function T obtain for the fifth data set, which be long in durat and produc the 
most randomness, be give in tabl 1 a an example. We comput threshold vthresh so that a 
sampl of n i.i.d. trial from the distribut infer from the train data would have a high 
probabl for exceed vthresh. 

for the fifth data set, a sampl of n i.i.d. trial from the distribut infer from the train 
data would have approxim 0.99 probabl of exceed a threshold of vthresh = 1.5×1032. 
thi would allow the extract of 1024 bit uniform to within �fin = 10−12, use �p = κ2 = 

6 



tabl 1: bell function T obtain from data set 5. We use a numer method base on 
maximum likelihood to infer a non-sign distribut base on the raw count of the train 
trials, name the first 5×106 trials. We then determin the function T that maxim e(lnt ) 
accord to thi distribution, subject to the constraint that e(t )lr ≤ 1 for all LR distribut 
and T (0, 0, x, y) = 1 for all x, y. the latter constraint improv the signal-to-nois for our 
data. the function T yield m = 0.0100425, and e(t ) = 1.000003931 for the non-sign 
distribut infer from the train data. one can also interpret the number below a the 
coeffici sabxi in eq. 1, which defin a bell inequ with β = 4. the valu of T be 
round down at the tenth digit. 

ab = ++ ab = +0 ab = 0+ ab = 00 
xy = 00 1.0243556353 0.9704647804 0.9735507658 1 
xy = 01 1.0256127409 0.9491951243 0.9960775334 1 
xy = 10 1.0227274988 0.9962782754 0.9461091383 1 
xy = 11 0.9273040563 1.0037217225 1.0039224645 1 

9.025 × 10−25 and �ext = 5 × 10−14. these valu be chosen base on a numer studi 
of the constraint on the number t of bit extract for fix valu of �fin = 10−12. run 
the protocol on the remain 55, 110, 210 trial with these parameters, the product 

∏n 
i=1 Ti 

exceed vthresh, and so the protocol passed. appli the extractor to the result output 
string AB with a seed of length d = 315, 844, we extract 1024 bits, certifi to be uniform to 
within 10−12, the first ten of which be 1110001001. figur 2 display the extract bit for 
altern choic of �fin for all five data sets. 

We also appli the protocol to data from the experi of ref. [13]. thi experi be 
more conserv in take addit measur to ensur that it be loophole-free, includ 
space-lik separ of the measur choic from both the downconvers event and 
the remot measur outcomes. We extract 256 bit at �fin = 0.02 from the best data 
set, xor 3, report in ref. [13]. the distanc from an ideal protocol a explain after the 
protocol sound theorem be 4.00 × 10−4, without account for possibl bia in the 
random sourc used. for detail see SI s.6. 

for the data set produc 1024 new near random bits, our protocol use 1.10 × 108 uni- 
form bit to choos the set and 3.16 × 105 uniform bit to choos the seed. becaus the 
extractor use be a “strong” extractor, the seed bit be still uniform condit on passing, so 
they can be recov at the end of the protocol for us elsewhere. thi be not the case for 
the settings-choic bit becaus the probabl of pass be less than 1. To reduc the entropi 
use for the settings, our protocol can be modifi to use highli bia set choic [5]. re- 
duce set entropi be not a prioriti if the set and seed bit come from a public sourc 
of randomness, in which case the output bit can still be certifi to be unknown to extern 
observ such a eve and the current protocol be an effect method for privat random 
gener [2, 10]. 

for futur work, we hope to take advantag of the adapt capabl of the entropi 

7 



product theorem (si s.2) to dynam compens for experiment drift dure run time. 
In view of advanc toward practic quantum comput it be desir to studi the protocol in 
the presenc of quantum side information, which may requir more conserv random 
generation. We also look forward to technic improv in experiment equip for 
larg violat and high trial rates. these will enabl faster gener of random bit with 
low error and support the use of bia set choices. 

exist random gener system reli on detail assumpt about the specif 
physic underli the devices. with the advent of loophole-fre bell tests, it be now possi- 
ble to build quantum devic that exploit quantum nonloc to remov mani of the device- 
depend assumpt in current technolog implementations. our device-independ ran- 
dom number gener be an exampl of such a system. such gener can provid the best 
method current know for physic produc randomness, therebi improv the secur 
of a wide rang of applications. 

method We use polarization-entangl photon gener by a nonlinear crystal pump by 
a pulsed, picosecond laser at approxim 775 nm in a configur similar to that report 
in ref. [13], but with sever improv to increas the rate of random extraction. the 
laser’ repetit rate be 79.3 mhz, and each puls that enter the crystal have a probabl of 
≈ 0.003 of creat an entangl photon pair in the state |ψ〉 ≈ 0.982 |hh〉+ 0.191 |V V 〉 at a 
center wavelength of 1550 nm. By pump the crystal with approxim five time a much 
power, and use a 20 mm long crystal, we be abl to substanti increas the per-puls 
probabl of gener a downconvers event compar with ref. [13] while maintain 
similar overal system efficiencies. the two entangl photon from each pair be separ 
sent to one of the two measur station (187±1) m apart. At alic and bob, a pockel cell 
and polar combin to allow the rapid switch of measur base and measur of 
the polar state of the incom photons. each pockel cell oper at a rate of 100 khz, 
allow u to perform 100,000 trial per second (the driver electron on the pockel cell set 
thi rate). the photon be then detect use fiber-coupl superconduct single-photon 
nanowir detectors, with bob’ detector oper at approxim 90% effici and alice’ 
detector oper with approxim 92% effici [34]. for thi experiment, the total sym- 
metric system herald effici be (75.5 ± 0.5%), which be abov the 71.5% threshold 
requir to close the detection-loophol for our experiment configur after account for 
unwant background count at our detector and slight imperfect in our state prepar 
and measur components. 

with thi configuration, bob complet hi measur (294.4 ± 3.7) n befor a hypo- 
thetic switch signal travel at light speed from alice’ pockel cell could arriv at hi 
station. similarly, alic complet her measur (424.2±3.7) n befor such a signal from 
bob’ pockel cell could arriv at her location. each trial’ outcom valu be obtain by 
aggreg the photon detect or non-detect event from sever short time interv last- 
ing 1024 ps, each of which be time to correspond to one puls of the pump laser. If ani photon 
be detect in the short intervals, the outcom be “+”, and if no photon be detected, the 

8 



outcom be “0”. the experi of ref. [13] use at most 7 short intervals, but here we be 
abl to includ 14 interv while maintain space-lik separation, which further increas 
the probabl of observ a photon dure each trial. for demonstr purposes, alic 
and bob each use python’ random.pi modul with the default gener (the mersenn 
twister) to pick their set at each trial. thi pseudorandom sourc be predictable, and for 
secur applic of the protocol in an adversari scenario, such a if the photon pair sourc 
or measur devic be obtain from an untrust provider, set choic must be base 
on random sourc that be effect not predictable. however, base on our knowledg of 
devic construction, we know that our devic have no physic resourc for predict pseudo- 
random number and expect that measur set be effect independ of relev 
devic so that eqs. 2 and 3 still hold. We remark that the set choic for the xor 3 data 
set be base on physic random sources. 

with the improv detect efficiency, the high per-trial probabl of for alic and bob 
to detect a photon, and a high signal-to-background count ratio we be abl to improv both 
the magnitud of our bell violat a well a reduc the number of trial requir to achiev a 
statist signific violat by an order of magnitude. 

refer 
[1] acı́n, A. & masanes, L. certifi random in quantum physics. natur 540, 213 

(2016). 

[2] pironio, S. & massar, S. secur of practic privat random generation. phys. rev. 
A 87, 012336 (2013). 

[3] miller, C. & shi, Y. robust protocol for secur expand random and distribut 
key use untrust quantum devices. J. acm 63, 33:1–33:63 (2016). 

[4] colbeck, R. & kent, A. privat random expans with untrust devices. J. phys. A: 
math. theor. 44, 095305 (2011). 

[5] pironio, S. et al. random number certifi by bell’ theorem. natur 464, 1021–4 (2010). 

[6] vazirani, U. & vidick, T. certifi quantum dice - or, exponenti random ex- 
pansion. In stoc’12 proceed of the 44th annual acm symposium on theori of 
computing, 61 (2012). 

[7] fehr, s., gelles, R. & schaffner, C. secur and compos of random expans 
from bell inequalities. phys. rev. A 87, 012335 (2013). 

[8] chung, k.-m., shi, Y. & wu, X. physic random extractors: gener random 
number with minim assumpt (2014). arxiv:1402.4797 [quant-ph]. 

9 



[9] nieto-silleras, o., pironio, S. & silman, J. use complet measur statist for 
optim device-independ random evaluation. new journal of physic 16, 013035 
(2014). 

[10] bancal, j.-d., sheridan, L. & scarani, V. more random from the same data. new 
journal of physic 16, 033011 (2014). 

[11] thinh, l., de la torre, g., bancal, j.-d., pironio, P. & scarani, V. random in post- 
select events. new journal of physic 18, 035007 (2016). 

[12] hensen, B. et al. loophole-fre bell inequ violat use electron spin separ 
by 1.3 km. natur 526, 682 (2015). 

[13] shalm, L. K. et al. strong loophole-fre test of local realism. phys. rev. lett. 115, 250402 
(2015). 

[14] giustina, M. et al. significant-loophole-fre test of bell’ theorem with entangl photons. 
phys. rev. lett. 115, 250401 (2015). 

[15] paar, C. & pelzl, J. understand crypotgraphi (springer-verlag berlin heidelberg, 
new york, 2010). 

[16] fischer, M. j., iorga, M. & peralta, R. A public random service. In secrypt 2011, 
434–38 (2011). 

[17] bell, J. On the einstein podolski rosen paradox. physic 1, 195–200 (1964). 

[18] bell, J. s., shimony, a., horne, M. A. & clauser, J. F. An exchang on local beables. 
dialectica 39, 85–96 (1985). 

[19] colbeck, R. quantum and relativist protocol for secur multi-parti computation. 
ph.d. thesis, univers of cambridg (2007). 

[20] pearle, P. M. hidden-vari exampl base upon data rejection. phys. rev. D 2, 1418– 
1425 (1970). 

[21] rosenfeld, W. et al. event-readi bell test use entangl atom simultan close 
detect and local loopholes. phys. rev. lett. 119, 010402 (2017). 

[22] brunner, n., cavalcanti, d., pironio, s., scarani, V. & wehner, S. bell nonlocality. rev. 
mod. phys. 86, 419–78 (2014). 

[23] cirel’son, B. S. quantum gener of bell’ inequality. lett. math. phys. 4, 93–100 
(1980). 

10 



[24] navascués, m., pironio, S. & acı́n, A. A converg hierarchi of semidefinit program 
character the set of quantum correlations. new journal of physic 10, 073013 (2008). 

[25] trevisan, L. extractor and pseudorandom generators. J. acm 48, 860–79 (2001). 

[26] mauerer, w., portmann, C. & scholz, V. A modular framework for random extract 
base on trevisan’ construct (2012). arxiv:1212.0520 [cs.it]. 

[27] coudron, M. & yuen, H. infinit random expans with a constant number of de- 
vices. In stoc’14 proceed of the 46th annual acm symposium on theori of com- 
puting, 427–36 (2014). 

[28] dupuis, f., fawzi, O. & renner, R. entropi accumul (2016). arxiv:1607.01796 
[quant-ph]. 

[29] arnon-friedman, r., renner, R. & vidick, T. simpl and tight device-independ secu- 
riti proof (2016). arxiv:1607.01797 [quant-ph]. 

[30] miller, C. & shi, Y. univers secur for random expans from the spot-check 
protocol (2014). arxiv:1411.6608 [quant-ph]. 

[31] zhang, y., glancy, S. & knill, E. asymptot optim data analysi for reject local 
realism. phys. rev. A 84, 062118 (2011). 

[32] trevisan, L. & vadhan, S. extract random from samplabl distributions. In foc 
’00 proceed of the 41st annual symposium on foundat of comput scienc 
(ieee comput society, washington, dc, 2000). 

[33] renner, R. secur of quantum key distribution. ph.d. thesis, eth, eth, switzerland 
(2006). arxiv:quant-ph/0512258. 

[34] marsili, F. et al. detect singl infrar photon with 93% system efficiency. natur 
photon 7, 210–214 (2013). 

acknowledg We thank carl miller and kevin coakley for comment on the manuscript. 
a.m. acknowledg financi support through nist grant 70nanb16h207. 

author contribut p.b. lead the project and implement the protocol. p.b., e.k., s.g. and 
y.z. develop the protocol theory. a.m., s.j., a.r. and y.-k. L. be respons for extractor 
theori and implementation. b.c., s.w.n., m.j.s. and l.k.s. collect and interpret the data. 
pb., e.k., s.g. and l.k.s. write the manuscript. 

author inform thi work be a contribut of the nation institut of standard and 
technolog and be not subject to u.s. copyright. the author declar no compet finan- 
cial interests. correspond and request for materi should be address to p.b. (pe- 
ter.bierhorst@nist.gov). 

11 



figur 1: the locat of the sourc (s), alic (a) and bob (b). each trial, the sourc 
lab produc a pair of photon in the non-maxim polarization-entangl state |ψ〉 ≈ 
0.982 |hh〉 + 0.191 |V V 〉, where H (V ) denot horizont (vertical) polarization. one pho- 
ton be sent to alice’ lab while the other be sent to bob’ lab to be measur a show in inset 
(b). alice’ comput optim polar measur angles, rel to a vertic polarizer, 
be {a = −3.7o, a′ = 23.6o} while bob’ be {b = 3.7o, b′ = −23.6o}. both alic and bob 
use a fast pockel cell (pc), two half-wavepl (hwp), a quarter-wavepl (qwp), and a 
polar beam displac to switch between their respect polar measurements. A 
pseudorandom number gener (rng) govern the choic of each measur set everi 
trial. after pass through the polar optics, the photon be coupl into a single-mod 
fiber and sent to a superconduct nanowir detector. the signal from the detector be then 
amplifi and sent to a time tagger where their arriv time be record and the measur 
outcom be fixed. A 10 mhz oscil keep alic and bob’ timetagg clock locked. alic 
and bob be (187 ± 1) m apart. At thi distance, alice’ measur outcom be space-lik 
separ from the trigger of bob’ pockel cell and vice-versa. 

12 



ǫ 
fin 

10-16 10-14 10-12 10-10 10-8 10-6 10-4 10-2 100 

E 
xt 

ra 
ct 

ab 
le 

B 
it 

1000 

2000 

3000 

4000 

5000 

6000 

set 1 
set 2 
set 3 
set 4 
set 5 

figur 2: extract bit a a function of error. the figur show the tradeoff between final 
error �fin and number of extract bit t for valu of vthresh pre-chosen to yield estim 
pass probabl exceed 95%. these threshold be met in each case. for all data 
set we set �p = κ2 = (0.95 �fin)2 and �ext = 0.05 �fin, a split that be gener found to be 
near-optim when numer maxim t in eq. 5 for fix valu of �fin. 

13 



experiment gener random certifi 
by the imposs of superlumin signal 

(supplementari information) 
peter bierhorst, emanuel knill, scott glancy, yanbao zhang, 

alan mink, stephen jordan, andrea rommal, yi-kai liu, 
bradley christensen, sae woo nam, martin J. stevens, lynden K. shalm 

after preliminari to establish notat and summar need properti of total variat 
distanc and non-sign distribut in s.1, we give the proof of the entropi product 
theorem in s.2. We explain how we chose the bell function T , whose product determin 
whether we obtain the desir amount of randomness, in s.3. We then discu the paramet 
of the extractor obtain by the tmp algorithm (s.4) and prove the protocol sound the- 
orem (s.5). detail on how we analyz the experiment data set be in s.6. justif for 
our claim that previou method do not obtain ani random from our low per-trial-viol 
data be give in s.7. 

s.1 preliminari 
We use the standard convent that capit letter refer to random variabl (rvs) and corre- 
spond lowercas letter refer to valu that the rv can take. all our rv take valu in finit 
set such a the set of bit string of a give length or a finit subset of the reals, so that our rv 
can be view a function on a finit probabl space. We usual just work with the induc 
joint distribut on the set of valu assum by the rvs. when work with condit 
probabilities, we implicitli exclud point where the condition have zero probabl whenev 
appropriate. We use p(. . .) to denot probabl and e(. . .) for expectations. insid p(. . .) 
and when use a conditioners, logic statement involv rv be event specif to be 
interpret a the event for which the statement be true. for example, p(r > δ) be equival to 
p({ω : r(ω) > δ}), which be the probabl of the event that the RV R take a valu great 
than δ. the same convent appli when denot event with {. . .}. for example, the event 
in the previou exampl be write a {R > δ}. while formal event be sets, we commonli 
use logic languag to describ relationship between events. for example, the statement that 
{R > δ} impli {S > �} mean that a a set, {R > δ} be contain in {S > �}. when 
they appear outsid the the mention contexts, logic statement be constraint on rvs. for 
example, the statement R > δ mean that all valu r of R satisfi r > δ, or equivalently, for all 
ω, r(ω) > δ. As usual, comma separ statement be combin conjunct (with “and”). 
(in the main text, for clarity, we have use an explicit “and” for thi purpose.) 

If there be free rv insid p(. . .) or in the condition of e(. . . | . . .) outsid event specifi- 
cations, the final express defin a new RV a a function of the free rvs. An exampl from 
the entropi product theorem be the express p(ab|xy), which defin the RV that take 
the valu p(ab = ab|xi = xy) when the event {abxi = abxy} occurs. valu of rv 
such a x appear by themselv in p(. . .) denot the event {X = x}. thu we abbrevi 

1 



express such a p(ab = ab|xi = xy) by p(ab|xy). sometim it be necessari to dis- 
ambigu the probabl distribut with respect to which e(. . .) be to be computed. In such 
case we use a subscript at the end of the express consist of a symbol for the probabl 
distribution, so e(t )Q be the expect of T with respect to the distribut Q. In a few in- 
stances, we use jφk for logic express φ to denot the {0, 1}-valu function evalu to 
1 iff φ be true. 

the amount of random that can be extract from an RV R be quantifi by the min- 
entropy, defin a − log2 maxr p(r = r). the error of the output of an extractor be give a 
the total variat (tv) distanc from uniform. given two probabl distribut P1 and P2 
for R, the TV distanc between them be give by 

tv(p1,p2) = 
1 

2 

∑ 
r 

|p1(r = r)− p2(r = r)| 

= 
∑ 

r:p1(r)>p2(r) 

(p1(r = r)− p2(r = r)) 

= 
∑ 
r 

jp1(r) > p2(r)k (p1(r = r)− p2(r = r)) . (s1) 

As the name implies, the TV distanc be a metric. In particular, it satisfi the triangl inequality: 

tv(p1,p3) ≤ tv(p1,p2) + tv(p2,p3). (s2) 

see ref. [35] for thi and other basic properti of TV distances. 
We sometim comput TV distanc for distribut of specif rvs, condit or uncon- 

dition ones. for thi we introduc the notat PX for the distribut of valu ofx accord 
to P, and px|y=i for the distribut of X condit on the event {Y = y}. with thi nota- 
tion, pxpi refer to the product distribut that assign probabl px(x = x)pi (Y = y) to 
the event {X = x, Y = y}. 

for the proof of the protocol sound theorem, we need two result involv the TV 
distance. accord to the first result, if P and Q be joint distribut of rv V and W , 
where the margin of W satisfi p(w) = q(w), then the distanc between them be give by 
the averag condit distance. thi be explicitli calcul a follows: 

tv(pvw ,qvw ) = 
∑ 
w 

∑ 
v 

jp(v, w) > q(v, w)k (p(v, w)−q(v, w)) 

= 
∑ 
w 

∑ 
v 

jp(v|w)p(w) > q(v|w)q(w)k (p(v|w)p(w)−q(v|w)q(w)) 

= 
∑ 
w 

∑ 
v 

jp(v|w) > q(v|w)k (p(v|w)−q(v|w))p(w) 

= 
∑ 
w 

tv(pv |w=w,qv |w=w)p(w). (s3) 

2 



the second result be a special case of the data-process inequ for TV distance. see 
ref. [36] for thi and mani other data-process inequalities. let V be a random variabl 
take valu in a finit set V , and let F : V → W be a function so that F (V ) be a random 
variabl take valu in the setw . then if P and Q be two distribut of V , 

TV 
( 
PV ,qv 

) 
≥ TV 

( 
PF (V ),qf (V ) 

) 
. (s4) 

here be a proof of thi inequality. writew = {s1, ..., sc}, and for each i ∈ {1, . . . , c}, defin 
Vi = {v : f(v) = si}. the Vi form a partit of V . then we have 

TV 
( 
PF (V ),qf (V ) 

) 
= 

1 

2 

c∑ 
i=1 

|p(v ∈ vi)−q(v ∈ vi)| 

= 
1 

2 

c∑ 
i=1 

∣∣∣∣∣∑ 
v∈vi 

[p(v = v)−q(v = v)] 

∣∣∣∣∣ 
≤ 1 

2 

c∑ 
i=1 

∑ 
v∈vi 

|p(v = v)−q(v = v)| 

= TV 
( 
PV ,qv 

) 
. (s5) 

We need to refer to the sequenc of rv associ with the first i − 1 trials. To do thi 
we use notat such a (ab)<i for the outcom sequenc a1b1a2b2...ai−1bi−1, (xy)<i 
for the set sequenc x1y1...xi−1yi−1, and (abxy)<i for the joint outcom and set 
sequenc a1b1x1y1...ai−1bi−1xi−1yi−1. In gener we often juxtapos rv to indic the 
“joint” rv. from our assumpt eqs. 2 and 3 and the fact that pasti subsum the trial set 
and outcom from trial 1 through i− 1, we obtain 

∀i ∈ (1, ..., n), Pe (xiyi|(abxy)<i) = pe(xiyi) = 1/4, (s6) 

and 

pe(ai|xiyi, (abxy)<i) = pe(ai|xi, (abxy)<i) 
pe(bi|xiyi, (abxy)<i) = pe(bi|yi, (abxy)<i). (s7) 

eq. S6 can be weaken to accommod imperfect set random by replac it with 
the follow two assumptions, where α ∈ [0, 1/4) be a paramet control deviat from 
uniformity: 

∀i ∈ (1, ..., n), 1/4− α ≤ Pe (xiyi|(abxy)<i) ≤ 1/4 + α (s8) 
pe(xiyi|(abxi )<i) = pe(xiyi|(xi )<i) (s9) 

eq. S6 be a strictli strong assumpt a it impli both eq. S8 (with α = 0) and eq. s9. 
eqs. s7, s8, and S9 be the form of our assumpt use in the proof of the entropi product 

3 



theorem. eq. S9 express condit independ of all past outcom and the upcom 
set give the past settings. It be a special case of the markov-chain condit in ref. [28]. 

for a gener trial of a two station bell test, a distribut be defin to be non-sign if 

p(a|xi ) = p(a|x) and p(b|xi ) = p(b|i ). (s10) 

such distribut form a convex polytop and includ the local realist (lr) distributions. 
use the convent of [22], these be defin a follows: let λ rang over the set of six- 
teen four-el vector of the form (a0, a1, b0, b1) with element in {+, 0}. each λ induc 
settings-condit determinist distribut accord to 

pλ(ab|xy) = 

{ 
1, if a = ax and b = by, 
0, otherwise. 

(s11) 

then a probabl distribut P be LR iff it condit probabl p(ab|xy) can be write 
a a convex combin of the pλ(ab|xy). that be 

p(ab|xy) = 
∑ 
λ 

qλpλ(ab|xy), (s12) 

with qλ a λ-index set of nonneg number sum to 1. thi definit agre with the 
one give in the main text. 

the eight “popescu-rohrlich (pr) boxes” [37] be exampl of non-sign distribut 
that be not lr. one of the PR box be defin by 

ppr(ab|xy) = 

{ 
1/2 if xy 6= 11 and a = b, or if xy = 11 and a 6= b, 
0 otherwise, 

(s13) 

and the other seven be obtain by relabel set or outcomes. We take advantag of the 
fact that a PR box contain one bit of random condit on the set and that the PR 
box togeth with the 16 determinist LR distribut of eq. s11 form the set of extrem 
point of the non-sign polytop [38]. 

s.2 proof of the entropi product theorem 
the condit on T give in the main text be that (1) T > 0, (2) e(t )P ≤ 1 for everi LR 
distribut P, (3) there exist anm > 0 such that e(t )Q ≤ 1+m for everi non-sign distri- 
bution Q if the set distribut be uniform a in eq. 2, and (4) the bound 1+m be achievable. 
our proof of the entropi product theorem do not requir that the fourth condit be sat- 
isfied. furthermore, we prove the entropi product theorem with a weaken form of the 
second and third conditions, assum that T satisfi condit (2) and (3) with ani set 
distribut satisfi eq. s8. In the following, we call thi relax version of condit (1)-(3) 

4 



“the bell-funct condit with bound m and set paramet α”. We also gener the 
entropi product theorem by allow the Ti to be chosen base on (abxy)<i. We call Ti a 
“past-parametr famili of bell functions” if for all (abxy)<i, ti(aibixiyi, (abxy)<i) satis- 
fie the bell-funct condit with bound m and set paramet α when consid a a 
function of the result aibixiyi from the i’th trial. By prove the theorem for past-parametr 
bell function T , we allow for the possibl of dynam adapt T dure run time, a 
featur that could compens for experiment drift in futur implement of the protocol. 
the theorem and it proof can also be directli appli to the special case where Ti be the same 
function for all trial i and α = 0. 

theorem 1. let Ti be a past-parametr famili of bell function a defin in the previou 
paragraph. then in an experi of n trial obey eq. s7, eq. S8 and eq. s9, the follow 
inequ hold for all �p ∈ (0, 1) and vthresh satisfi 1 ≤ vthresh ≤ (1 + (3/2)m)n�−1p : 

Pe (pe(ab|xy) > δ, V ≥ vthresh) ≤ �p (s14) 

where δ = [1+(1− n√�pvthresh)/2m]n and Pe repres the probabl distribut condit 
on the event {E = e}. 

We includ the constraint vthresh ≤ (1+(3/2)m)n�−1p for technic reasons. higher valu of 
vthresh be unreason larg and result in pa probabl that be too low to be relevant. note 
that thi bound ensur δ ≥ 2−2n, a fact that will be use in prove the protocol sound 
theorem in (s.5). 

proof. sinc the condit on {E = e} appear uniformli throughout, in thi proof we omit 
the subscript on Pe specifi condit on {E = e}. 

the strategi of the proof be to first obtain an upper bound on the one-tri outcom probabil- 
iti from the expect of bell function T . thi bound can be chain to give a bound on 
the probabl of the outcom sequenc a a monoton decreas function of the prod- 
uct of the condit expect of the ti. that is, a larg product of expect yield a 
small maximum probabl and therefor more extract randomness. thi product can- 
not be directli observed, so we relat it to the observ product V of the Ti via the markov 
inequ appli to an associ positive, mean-1 martingale. In the following, we suppress 
the argument aibixiyi and (abxy)<i of ti. 

the one-tri outcom probabl be bound by mean of the follow lemma: 

lemma 1. let T satisfi the bell-funct condit with bound m > 0 and set paramet 
α. for ani non-sign distribut P satisfi eq. s8, 

max 
abxi 

p(ab|xy) ≤ 1 + 1− e[t (a,b,x, Y )]p 
2m 

. (s15) 

proof. the settings-condit distribut p(ab|xy) be non-signaling, so it can be obtain a 
a convex combin of extrem such distributions. the convex combin requir at most 

5 



one PR box ( [39], corollari 2.1), so we write p(ab|xy) = pq(ab|xy) + (1 − p)q′(ab|xy), 
where Q be the PR box and Q′ be lr. We thu have 

e(t )P = 
∑ 
abxi 

T (abxy)p(abxy) = 
∑ 
xy 

(∑ 
ab 

T (abxy)p(ab|xy) 

) 
p(xy) 

= p 
∑ 
abxi 

T (abxy)q(ab|xy)p(xy) + (1− p) 
∑ 
abxi 

T (abxy)q′(ab|xy)p(xy) 

≤ p(1 +m) + (1− p) = 1 + pm, (s16) 

where the inequ abov hold becaus q(ab|xy)p(xy) and q′(ab|xy)p(xy) respect 
defin non-sign and LR distribut satisfi eq. s8, and henc these distribut re- 
spectiv satisfi e(t ) ≤ 1 +m and e(t ) ≤ 1. the abov inequ can be re-written a p ≥ 
(e(t )P − 1)/m. now sinc the PR box assign xy-condit probabl 1/2 to at least one 
outcom differ from ab, it follow that the xy-condit probabl rel to P of an out- 
come differ from ab be at least p/2. therefore, p(ab|xy) ≤ 1−p/2 ≤ 1−(e(t )p−1)/(2m). 
sinc ab and xy be arbitrary, thi give the inequ the lemma. 

We can now establish a bound on p(ab|xy) a follows: 

p(ab|xy) = 
n∏ 
i=1 

p(aibi|(ab)<i,xy) 

= 
n∏ 
i=1 

p(aibi|(abxy)<i, xiyi) 

≤ 
n∏ 
i=1 

[ 
1 + 

1− e(ti|(abxy)<i) 
2m 

] 
. (s17) 

here, the first ident be the chain rule for condit probabilities, and the second follow 
from repeat applic of the follow identity, which hold for all j in (i+ 1, i+ 2, ..., n) 
(where we recal that (xy)<n+1 = xy and (ab)<i(xy)<i+1 = (abxy)<i, xiyi). the third 
equal below be a consequ of eq. s9: 

p(aibi|(ab)<i, (xy)<j+1) = 
p(aibi, (ab)<i, (xy)<j+1) 
p((ab)<i, (xy)<j+1) 

= 
p(xjyj|aibi, (ab)<i, (xy)<j)p(aibi, (ab)<i, (xy)<j) 

p(xjyj|(ab)<i, (xy)<j)p((ab)<i, (xy)<j) 

= 
p(xjyj|(xy)<j)p(aibi, (ab)<i, (xy)<j) 
p(xjyj|(xy)<j)p((ab)<i, (xy)<j) 

= p(aibi|(ab)<i, (xy)<j). (s18) 

finally, the inequ in eq. s17 be a consequ of our assumpt in eq. S7 that the past- 
depend distribut be non-signaling, which allow u to appli the bound from lemma 1. 

6 



now, by twice use the fact that the geometr mean of a set of posit number be alway less 
than or equal to their arithmet mean, we continu from the last line of eq. s17: 

n∏ 
i=1 

[ 
1 + 

1− e(ti|(abxy)<i) 
2m 

] 
= 

{ n∏ 
i=1 

[ 
1 + 

1− e(ti|(abxy)<i) 
2m 

]} 1nn 

≤ 

∑ni=1 
[ 
1 + 1−e(ti|(abxy)<i) 

2m 

] 
n 

n 

= 

1 + 1 
2m 
− 

∑n 
i=1 

[ 
e(ti|(abxy)<i) 

2m 

] 
n 

n 

≤ 

1 + 1 
2m 
− 

[ 
n∏ 
i=1 

e(ti|(abxy)<i) 
2m 

] 1 
n 

n 

= 

( 
1 + 

1− [ 
∏n 

i=1 e(ti|(abxy)<i)] 
1 
n 

2m 

)n 
. (s19) 

refer back to the statement of the theorem, we see that δ can be express a f(�pvthresh) 
where f(x) = [1+(1− n 

√ 
x)/2m]n. express eq. s19 in term of thi same function f , we see 

that the event {p(ab|xy) > δ} impli the event {f ( 
∏n 

i=1 e(ti|(abxy)<i)) > δ}. the 
latter event be the same a { 

∏n 
i=1 e(ti|(abxy)<i) < f−1(δ) = �pvthresh}, sinc f−1 be strictli 

decreasing. conjoin the event {V ≥ vthresh} to both side of the implication, we have 
{p(ab|xy) > δ, V ≥ vthresh} impli { 

∏n 
i=1 e(ti|(abxy)<i) < �pvthresh, V ≥ vthresh}, 

and so by the monoton of probabilities, 

P (p(ab|xy) > δ, V ≥ vthresh) ≤ P 

( 
n∏ 
i=1 

e(ti|(abxy)<i) < �pvthresh, V ≥ vthresh 

) 
. 

(s20) 
the event {φ} whose probabl appear on the left-hand side of thi equat be the event 
in the theorem statement whose probabl we be requir to bound. for ani valu of the 
rvs, the two inequ in the event on the right-hand side impli the inequ in the event 
{ψ} = {v/ 

∏n 
i=1 e(ti|(abxy)<i) ≥ 1/�p}. henc p(φ) ≤ p(ψ). It remain to show that 

p(ψ) ≤ �p. for thi purpos we defin the sequenc {wc}nc=1 of rv by 

Wc = 
c∏ 
i=1 

Ti 
e(ti|(abxy)<i) 

, (s21) 

so that {ψ} = {wn ≥ 1/�p}. 

7 



By definition, Wc > 0 and the factor ti/e(ti|(abxy)<i) have expect 1 condit 
on the past. sequenc of rv with these properti be refer to a test martingal [40] and 
satisfi that e(wn) = 1, which can be verifi directli by induction: 

e(wc|(abxy)<c) = E 

( 
c∏ 
i=1 

Ti 
e(ti|(abxy)<i) 

∣∣∣∣∣(abxy)<c 
) 

= E 

(( 
c−1∏ 
i=1 

Ti 
e(ti|(abxy)<i) 

) 
1 

e(tc|(abxy)<c) 
Tc 

∣∣∣∣∣(abxy)<c 
) 

= 

( 
c−1∏ 
i=1 

Ti 
e(ti|(abxy)<i) 

) 
1 

e(tc|(abxy)<c) 
E (tc|(abxy)<c) 

= wc−1, (s22) 

where in the second last line, we pull out factor that be function of the condition (abxy)<c 
by appli the rule that if F be a function of H , then e(fg|h) = fe(g|h). take the un- 
condit expect of both side of eq. s22 and invok the law of total expectation, we 
have e(wc) = e(wc−1), and so inductively, e(wn) = e(w1). sinc e(w1) = 1, the claim 
follows. To finish the proof of the entropi product theorem, we appli markov’ inequ 
to obtain p(wn ≥ 1/�p) ≤ �p and consequ p(φ) ≤ �p. 

now that we have prove the entropi product theorem for ani past-parametr famili 
of bell functions, we can justifi a strategi of set the remain bell function to Ti = 1 
after vthresh be exceed by the run product mid-protocol. formally, sinc the run 
product vi−1 = 

∏i−1 
i=j Tj be a function of (abxy)<i, we can defin Ti = T condit on 

{vi−1 < vthresh} and Ti = 1 condit on the complement. thi option strategi can be use 
to elimin the possibl that statist fluctuat or experiment drift could caus 

∏n 
i=1 Ti 

to be less than vthresh even though the run product exceed vthresh at some point prior to n. 

s.3 choos the bell function T 
the entropi product theorem do not indic how to find function T satisfi the spec- 
ifi conditions. We seek a high typic valu of V = 

∏n 
i=1 ti, a thi permit larg valu of 

vthresh and consequ more extract random at the same valu of �p and m. here, 
we describ a procedur for construct a function T that can be expect to perform well if 
the trial result be i.i.d. with know distribution. We estim the distribut from an initi 
portion of the run that we set asid a train data, and in a stabl experi we expect that 
the trial results’ statist be i.i.d. to a good approximation. note howev that the optimist 
i.i.d. assumpt be onli use a a heurist to construct T ; onc T be chosen the guarante of 
the entropi product theorem hold regardless of whether the trial result be actual i.i.d. 

8 



We first focu on the scenario where eq. S6 be assum to hold, then show how to proceed if 
thi be replac with the weaker assumpt eq. S8 and eq. s9. 

the observ measur outcom frequenc for train data gener yield a weakli 
signal distribut that do not exactli satisfi the non-sign constraint in eq. s10, due 
to statist fluctuation. henc one can obtain an estim distribut by determin the 
maximum likelihood non-sign distribut for the observ measur outcom fre- 
quenci a describ in ref. [31]. let n(xy) be the number of train trial at set xy and 
f(ab|xy) = n(ab|xy)/n(xy) be the empir frequenc of outcom ab give set xy. let 
q(a, b, x, y) be a candid for the probabl distribut from which these frequenc be 
sampled. then up to an addit term independ of Q account for the set probabili- 
ties, the log-likelihood of f give Q be l(q) = 

∑ 
a,b,x,yn(xy)f(ab|xy) ln(q(a, b|x, y)). We 

maxim a variant of thi function to find our estim distribut q(a, b, x, y): 

maxim 
Q 

∑ 
abxi 

f(ab|xy) lnq(a, b, x, y) (s23) 

subject to q(x, y) = 1/4 for x, y ∈ {0, 1} 
q(a|x, y) = q(a|x) for x, y ∈ {0, 1}, a ∈ {+, 0} 
q(b|x, y) = q(b|y) for x, y ∈ {0, 1}, b ∈ {+, 0}. 

the first group of constraint encod our knowledg that all set combin be equal 
likely, and the remain constraint be the non-sign constraints. note that the condit 
express in these constraint be equival express a linear function of q(a, b, x, y) 
after use the ident q(x, y) = 1/4. 

onc the estim distribut Q be obtained, we maxim the typic valu of V by 
take advantag of the observ that the condit on T impli that V −1 be a conserv p- 
valu against local realism [31]. such p-valu be studi in ref. [31], which give a gener 
strategy, the pbr method, for maxim e(ln(v ))q. thi be use becaus typic valu of 
V be close to exp(ne(ln(t ))q): sinc ln(v ) = 

∑n 
i=1 ln(ti) be a sum of i.i.d. bound term 

(given our optimist assumption), the central limit theorem ensur that lnv be approxim 
normal distribut with mean ne(ln(t ))q. We therefor perform the follow optim 
problem to find T : 

maxim 
T 

e(ln(t ))q (s24) 

subject to e(t )pλ ≤ 1 ∀λ 
T (0, 0, x, y) = 1 ∀x, y, 

where Pλ refer to the 16 condit determinist LR distribut in eq. s11 with uniform 
set distributions. thi ensur that e(t )plr ≤ 1 for all LR distribut plr with uniform 
set distributions. the second constraint be motiv by the fact that in our experiments, an 

9 



overwhelm fraction of the trial have no detect for both stations. while it be possibl that 
a good e(ln(t ))q can be obtain without thi constraint, we have found that the improv 
be small and like not statist signific give the amount of train data use to deter- 
mine the result distribution. sinc the object function be concav and the constraint be 
linear, the optim problem give in eq. s23 and eq. s24 be readili solv numer 
with standard tools. 

given the assumpt that the trial result be i.i.d., the previou paragraph show that the 
typic valu for V be exponenti in the number of trials, V = e−ne(ln(t ))−o(n). If the exper- 
iment be success in show violat of local realism, e(ln(t )) be positive. neglect the 
contribut from o(n), with vthresh = ene(ln(t )), we can bound − ln(δ) a 

− ln(δ) = −n ln(1 + (1− (�pene(ln(t )))1/n)/(2m)) 
= −n ln(1 + (1− ee(ln(t ))+ln(�p)/n)/(2m)) 
≥ −n(1− ee(ln(t ))+ln(�p)/n)/(2m) 
= n(ee(ln(t ))+ln(�p)/n − 1)/(2m) 
≥ (ne(ln(t )) + ln(�p))/(2m). (s25) 

where we use − ln(1 + x) ≥ −x and ex − 1 ≥ x. thi show that asymptot (with �p 
constant) we get at least e(ln(t )) log2(e)/(2m) = e(log2(t ))/(2m) bit of random per 
trial. for the empir distribut obtain from the fifth data set (“data set 5”) use for the 
protocol accord to eq. s23, we obtain e(log2(t ))/2m = 1.42×10−4. the bound in eq. s25 
show that we can get an asymptot posit number of bit of random per trial even 
with �p exponenti small in n. 

now we turn to the problem of find a function satisfi the condit e(t )plr ≤ 1 
for all LR distribut plr with set distribut constrain onli by the weaker condit 
eq. s8, which replac the strong exact uniform condit of eq. s6. To do this, we show 
that it be suffici to check onli distribut with the extrem set distribut where two 
set have probabl 1/4+α and the two other set distribut have probabl 1/4− 
α. To see whi thi be possible, for a fix posit bell function T , let P be an LR distribut 
whose set distribut be constrain by eq. s8. take advantag of the represent in 
eq. s12, 

e(t )P = 
∑ 
abxi 

T (abxy)p(ab|xy)p(xy) = 
∑ 
abxi 

T (abxy) 

(∑ 
λ 

qλpλ(ab|xy) 

) 
p(xy) 

= 
∑ 
λ 

qλ 
∑ 
abxi 

T (abxy)pλ(ab|xy)p(xy) ≤ max 
λ 

∑ 
abxi 

T (abxy)pλ(ab|xy)p(xy), (s26) 

so the expect valu of T with respect to P be alway less than or equal to the expect valu 
of T with respect to a condit determinist LR distribut Pλ with the same set 
distribution. sinc each determinist LR distribut assign condit probabl 1 to a sin- 
gle outcom ab for each of the four set choic xy, the sum 

∑ 
abxi T (abxy)pλ(ab|xy)p(xy) 

10 



contain onli four nonzero terms. consid the two larg valu of T (abxy) and the two small- 
est valu of T (abxy) appear in the four nonzero terms. note that 

∑ 
abxi T (abxy)pλ(ab|xy)p(xy) ≤∑ 

abxi T (abxy)pλ(ab|xy)p∗(xy), where p∗(xi ) be the distribut that assign probabl 
1/4 + α to the two set correspond to the two larg T , and probabl 1/4 − α to 
the two set correspond to the two small T . henc for ani T , we can ensur that 
e(t )P ≤ 1 hold for all LR distribut by check that e(t )P ≤ 1 hold for each condi- 
tional distribut pλab|xi coupl with each of the i = 1, . . . , 

( 
4 
2 

) 
= 6 set distribut 

sixi assign probabl 1/4 +α to two set and 1/4−α to two other settings. thi lead 
u to the maxim problem 

maxim 
T 

e(ln(t ))q (s27) 

subject to e(t )pλ 
ab|xi S 

i 
XY 
≤ 1 ∀λ, i 

T (0, 0, x, y) = 1 ∀x, y. 

the new problem maxim the same object function a in eq. s24 subject to a larger, but 
still finite, number of constraints. It can be solv numer to find a bell function for the 
weak set distribution. 

s.4 the tmp algorithm 
A strong random extractor with paramet (σ, �, q, d, t) be a function ext : {0, 1}q × 
{0, 1}d → {0, 1}t with the properti that for ani random string R of length q and min-entropi at 
least σ, and an independent, uniformli distribut seed string S of length d, the distribut of 
the concaten ext(rs) with S of length t+ d be within TV distanc � of uniform. there be 
construct of extractor that extract most of the input min-entropi σ with few seed bits. for 
a review of the achiev asymptot tradeoffs, see ref. [41], chapter 6. for explicit extractor 
that perform well if not optimally, we use a version of trevisan’ construct [25] imple- 
ment by mauerer, portmann and scholz [26], which we adapted1 to make it function in our 
environ and to incorpor recent construct achiev improv paramet [42]. We 
call thi construct the tmp algorithm. for a fix choic of σ, � and q, the tmp algorithm 
can construct a strong random extractor for ani valu t obey the follow bound: 

t+ 4 log2 t ≤ σ − 6 + 4 log2(�). (s28) 

given t, the length of the seed satisfi 

d ≤ w2 ·max {2, 1 + d[log2(t− e)− log2(w − e)]/[log2 e− log2(e− 1)]e} , (s29) 

wherew be the small prime larg than 2×dlog2(4qt2/�2)e. We note that the tmp extractor 
be secur against classic and quantum side inform [26], and thi secur be reflect in 
the paramet constraints. sinc we do not take direct advantag of thi security, it be in principl 

1our adapt sourc code be avail at https://github.com/usnistgov/libtrevisan. 

11 

https://github.com/usnistgov/libtrevisan 


possibl to improv the paramet in the protocol sound theorem. It may also be possibl 
relax the requir of seed uniform with more advanc constructions. for the purpos 
random amplif thi be theoret accomplish in ref. [43]. 

for the bound on the the number of seed bit give after the protocol sound theorem 
in the main text, we have q = 2n and � = �ext/2. sinc for ani r, there be a prime w satisfi 
r < w ≤ 2r, w = o(log(n) + log(t/�)) = o(log(nt/�)), where we pull out expon from 
the log, and drop and arbitrarili increas the implicit constant in front of each term to 
match summands. the coeffici of w2 in the bound on d be o(log(t)), becaus of the “minus” 
sign in front of the term contain w. multipli give d = o(log(t) log(nt/�ext)2). 

s.5 proof of the protocol sound theorem 
the distinct between the station be need to establish the inequ in the entropi pro- 
duction theorem and play no further role in thi section. We therefor simplifi the notat by 
abbrevi C = AB and either Z = XY or Z = xye. In the former case p(. . .) refer to 
probabl condit on {E = e}. otherwise, p(. . .) involv no implicit conditions. the 
protocol sound theorem hold regardless of which definit of Z be in force. We write 
rpass to refer to the RV that take valu 1 condit on the pass event {V ≥ vthresh} and 0 
otherwise. the constant �p and δ appear below be the same a in the entropi product 
theorem. 

theorem 2. let 0 < �ext, κ < 1. suppos p(pass) ≥ κ, and suppos t be a posit integ 
satisfi 

t+ 4 log2 t ≤ − log2 δ + log2 κ+ 5 log2 �ext − 11. (s30) 

then if ext : {0, 1}2n × {0, 1}d → {0, 1}t be obtain by the tmp algorithm with paramet 
σ = − log2[2δ/(κ�ext)] and � = �ext/2, and S be a random bit string of length d independ of 
the joint distribut of c,z, rpass, then the joint distribut of U = ext(cs), Z, S and rpass 
satisfi 

TV 
( 
puzs|rpass=1,punifu punif pz|rpass=1 

) 
≤ �p/p(pass) + �ext, (s31) 

where punif denot the uniform probabl distribution. 

At thi point it be tempt to just appli an extractor to AB with paramet σ give by the 
nomin �p-smooth min-entropi σ = − log2(δ). however, thi do not guarante the strong 
condit eq. s31. specifically, there be three reason that eq. s14 of the entropi product 
theorem do not immedi support the applic of an extractor to ab. the first be that 
a specified, the extractor input should have min-entropi − log2 maxab p(ab = ab) = σ with 
no smooth error. the second be that the settings-condit smooth min-entropi can be 
substanti small than the nomin one. the third be that the min-entropi be also affect by 
the probabl of pass be less than 1. account for these effect requir an analysi 
of the settings- and pass-condit distribut and the extractor paramet specifi in the 
theorem. 

12 



proof. the proof proce in two main step inspir by the correspond argument in ref. [2]. 
In the first we determin a probabl distribut P∗ that be within �p of P but satisfi an ap- 
propriat bound on the condit probabl of C with probabl 1 rather than 1− �p. the 
distribut p∗’ margin agre with those of P on zs. the probabl condit on abort- 
ing also agree, and uniform and independ of S be preserved. In the second step, we appli 
a proposit from ref. [44] on appli extractor to distribut such a P∗ whose averag 
maximum condit probabl satisfi a specifi bound. the proposit enabl u to 
determin the extractor paramet that achiev the requir final distanc �p/p(pass) + �ext in 
the theorem. 

the entropi product theorem guarante that p(p(c|z) > δ,rpass = 1) ≤ �p. In the 
case where E be includ in Z, thi follow by the uniform in {E = e} of the theorem’ 
conclusion: 

p(p(c|z, E) > δ,rpass = 1) = 
∑ 
e 

p(p(c|z, E) > δ,rpass = 1|e = e)p( = e) 

= 
∑ 
e 

p(p(c|z, E = e) > δ,rpass = 1|e = e)p( = e) 

≤ 
∑ 
e 

�pp(e) 

= �p. (s32) 

use the follow construction, one may observ that for ani random variabl U with 
valu in a set of cardin K and γ satisfi 1/k ≤ γ, and ani distribut P′ of U , 
there exist p′′ such that p′′(u = u) ≤ γ for all possibl outcom u and p′′ be within TV 
distanc p′(p′(u) > γ) of p′. To construct p′′, for u such that p′(u) > γ, set p′′(u) = γ. To 
compens for the reduc probabilities, increas the valu of P′ to obtain those of p′′ without 
exceed γ on the set {u : p′(u) ≤ γ} so that p′′ be a normal probabl distribution. 
thi be possibl becaus in construct p′′ from p′, the total reduct in probabl on {u : 
p′(u) > γ} give by r− = 

∑ 
u:p′(u)>γ(p′(u) − γ) be less than the maximum total increas 

possibl give by r+ = 
∑ 

u:p′(u)≤γ(γ − p′(u)), a a consequ of γ ≥ 1/k. To see this, 
comput r+ − r− = 

∑ 
u(γ − p′(u)) ≥ 

∑ 
u(1/k − p′(u)) = 0. the distanc tv(p′,p′′) be 

give by 
∑ 

u:p′(u)>γ(p′(u) − γ) ≤ p′(p′(u) > γ). We can now construct P∗ by defin it 
condit distribut on C. for this, substitut U ← C, p′(u) ← p(c|z, rpass = 1), γ ← 
δ/p(rpass = 1|z) and p′′(u) ← p∗(c|z, rpass = 1). the constraint on γ be satisfi becaus 
the upper bound on vthresh in the statement of the entropi product theorem ensur that 
δ ≥ 2−2n. each condit distribut satisfi p∗(c|z, rpass = 1) ≤ δ/p(rpass = 1|z), which 
be equival to p∗(c, rpass = 1|z) ≤ δ, and be within TV distanc P 

( 
p(c|z, rpass = 1) > 

δ/p(rpass=1|z) 
∣∣z, rpass = 1) of pc|z,rpass=1. the joint probabl distribut P∗ be determin 

pointwis from the alreadi assign valu of p∗(c|zrpass) for rpass = 1 a 

p∗(czsrpass) = 
{ 

p∗(c|zrpass)p(zsrpass) if rpass = 1 
p(czsrpass) otherwise. 

(s33) 

13 



sinc the margin distribut of zsrpass be unchanged, the full TV distanc between P and P∗ 
be give by the averag condit TV distanc with respect to zsrpass, see eq. s3. sinc the 
condit TV distanc be zero when rpass = 0 and from independ of S, we obtain 

tv(p∗czsrpass ,pczsrpass) 

= 
∑ 
zsrpass 

TV 
( 
p∗c|zsrpass ,pc|zsrpass 

) 
p(zsrpass) 

= 
∑ 
zsrpass 

TV 
( 
p∗c|zsrpass ,pc|zsrpass 

) 
jrpass = 1kp(zsrpass) 

≤ 
∑ 
zsrpass 

P 
( 
p(c, rpass = 1|z) > δ 

∣∣z, rpass = 1)jrpass = 1kp(zsrpass) 
= 

∑ 
zrpass 

P 
( 
p(c, rpass = 1|z) > δ 

∣∣z, rpass = 1)jrpass = 1kp(zrpass) 
= 

∑ 
czrpass 

jp(crpass|z) > δkp(c|zrpass)jrpass = 1kp(zrpass) 

= 
∑ 
czrpass 

jp(crpass|z) > δkjrpass = 1kp(czrpass) 

= p(p(crpass|z) > δ,rpass = 1) 
≤ p(p(c|z) > δ,rpass = 1) 
≤ �p. (s34) 

At thi point we can also bound the TV distanc condit on passing. sinc p∗(rpass) = 
p(rpass), we can appli eq. S3 and the abov bound on the distanc to get 

�p ≥ TV 
( 
p∗czsrpass ,pczsrpass 

) 
= 

∑ 
r 

TV 
( 
p∗czs|rpass=r,pczs|rpass=r 

) 
p(rpass = r) 

= TV 
( 
p∗czs|rpass=1,pczs|rpass=1 

) 
p(rpass = 1). (s35) 

We conclud that 

TV 
( 
p∗czs|rpass=1,pczs|rpass=1 

) 
≤ �p/p(rpass = 1). (s36) 

for the second main step, we need the averag “guess probability” of C give Z condi- 
tional on {rpass = 1}. thi be give by∑ 

z 

max 
c 

(p∗(c|z, rpass = 1))p(z|rpass = 1) ≤ 
∑ 
z 

δ 

p(rpass = 1|z) 
p(z|rpass = 1) 

= δ 
∑ 
z 

p(z) 
p(rpass = 1) 

≤ δ/κ. (s37) 

14 



We remark that here it be necessari to assum the low bound κ on p(rpass = 1) in order to 
proceed; otherwis the bound in eq. s37 would becom unbound due to potenti arbitrarili 
small valu of p(rpass = 1). now we can appli proposit 1 of ref. [44]. the next lemma 
extract the conclus of thi proposit in the form we need. It be obtain by substitut the 
variabl and express in the refer a follows: X ← C, Y ← S, E ← Z, e(x, Y ) ← 
ext(cs), k ← − log2(δ/κ)−log2(2/�ext), �← �ext/2 and the distribut be replac with the 
correspond one that be condit on {rpass = 1}. the guess entropi in the refer 
be the neg logarithm of the the averag guess probabl in eq. s37. 

lemma 2. suppos that ext be a strong extractor with paramet 
(− log2(2δ/(κ�ext)), �ext/2, 2n, d, t). write U = ext(cs). then we have the follow 
bound: 

TV 
( 
p∗uzs|rpass=1,p 

unif 
U psp∗z|rpass=1 

) 
≤ �ext. (s38) 

To appli the lemma, we obtain ext by the tmp algorithm with the paramet in the 
lemma. expand the logarithm a σ = − log2(δ) + log2(κ) + log2(�ext) − 1 and log2(�) = 
log2(�ext)− 1 and substitut in eq. s28 give the requir 

t+ 4 log2 t ≤ − log2(δ) + log2(κ) + 5 log2(�ext)− 11, (s39) 

a assert in the protocol sound theorem. the number of seed bit d be obtain from 
eq. s29. 

It remain to determin the overal TV distanc condit on passing. appli eq. S4 
with V = c,z, and F defin a F (c,z,s) = 

( 
ext(c,s),z, 

) 
, and appli eq. s36, we 

have 

TV 
( 
p∗uzs|rpass=1,puzs|rpass=1 

) 
≤ TV 

( 
p∗czs|rpass=1,pczs|rpass=1 

) 
≤ �p/p(rpass = 1). (s40) 

then by eq. s2, eq. s38 and eq. s40, we have 

TV 
( 
puzs|rpass=1,punifu punif p∗z|rpass=1 

) 
≤ �ext + �p/p(rpass = 1). (s41) 

As p∗z|rpass=1 = pz|rpass=1, the statement of the theorem follows. 

As discuss in the main text, the protocol sound theorem impli that the uncondi- 
tional TV distanc from an “ideal protocol” can be bound by max(�p + �ext, κ). thi error 
paramet be close relat to the secur definit appear in, for instance, equat (1) 
of [45] and definit 4 of [29]. To explain how we arriv at max(�p + �ext, κ), note that an 
ideal protocol may abort with posit probability, but condit on not abort it produc 
perfectli uniform output independ of side information. that is, the distribut of an ideal 
protocol pidealuzsrpass must satisfi P 

ideal 
uzs|rpass=1 = P 

unif 
U punif pidealz|rpass=1, but the distribut of the 

ideal protocol be otherwis unconstrain when rpass = 0. given our actual protocol distribu- 
tion P we can defin a particular ideal distribut with the same probabl of pass a the 
actual protocol by set pidealuzs|rpass=1 = P 

unif 
U punif pz|rpass=1, pidealuzs|rpass=0 = puzs|rpass=0, and 

15 



pideal(rpass = 1) = p(rpass = 1). If p(rpass = 1) ≥ κ, the uncondit TV distanc from P 
to thi ideal protocol can be bound by 

TV (puzsrpass ,pidealuzsrpass) = 
∑ 
r=0,1 

TV (puzs|rpass=r,pidealuzs|rpass=r)p(rpass = r) 

= TV (puzs|rpass=1,pidealuzs|rpass=1)p(rpass = 1) 
≤ [�p/p(rpass = 1) + �ext]p(rpass = 1) 
≤ �p + �ext, (s42) 

where abov we used, in order, eq. s3, pidealuzs|rpass=0 = puzs|rpass=0, eq. s31, and p(rpass = 
1) ≤ 1. alternatively, if p(rpass = 1) < κ, we have 

TV (puzsrpass ,pidealuzsrpass) = TV (puzs|rpass=1,p 
ideal 
uzs|rpass=1)p(rpass = 1) 

≤ 1 · κ 
= κ, (s43) 

a the TV distanc can never be great than one. thu we see that the distanc from the ideal 
protocol be bound by max(�p + �ext, κ). however, a note in the main text, we consid 
a more conserv overal error paramet �fin = max(�p/κ + �ext, κ). thi ensur that 
for all pa probabl exceed κ, the pass-condit distribut of the output be within 
�p/p(pass) + �ext ≤ �p/κ+ �ext ≤ �fin of punifu punif pz|rpass=1. 

s.6 protocol applic detail 
the protocol sound theorem support the protocol give in tabl s1, with overal sound- 
ness error give by �fin = max(�p/κ+ �ext, κ). A protocol be furthermor complet if there exist 
real-world system that pa the protocol with reason high probability. the complet 
of our protocol be support by quantum mechanics, which predict experiment distribut 
that violat nontrivi bell inequ [17] and pa the protocol with high probability. com- 
plete be also wit by our repeat success implement of the protocol. 

the five new data set report in the main paper be take in 2017. each trial in a data 
set encompass fourteen time intervals, and in a give trial, the outcom “+” be record if 
there be a detect in ani one of these interv and “0” otherwise. the number of interv 
be fix and chosen in advanc of run the protocol. the five data set be analyz in the 
order in which they be taken. We determin the bell function T from train data consist 
of the first 5 × 106 trial a explain in s.3. We chose 5 × 106 trial so that we could obtain 
a bell function T use an accur estim of the experiment distribut of measur 
outcom without sacrific too much data that could be use for random generation. after 
the protocol be offici run on a data set, the same data set be re-analyz use differ 
length of train portion to see if a differ length should be use for subsequ data sets, 
but there be never clear evid to suggest that we should have use a differ length for the 
train portion. 

16 



tabl s1: protocol for random gener 
1. choos a bell function T satisfi the condit of the entropi product theorem, 
a number of trial n to be run, a threshold for pass vthresh > 1, error paramet 
�p, �ext, κ > 0, and a posit integ t for which eq. 5 be satisfied. 

2. (entropi production) run a success of n experiment trials, where in each trial 
i alic and bob randomli and uniformli choos respect set xi, Yi ∈ {0, 1}, and 
record respect output ai, Bi ∈ {+, 0}. (optional) calcul 

∏i 
j=1 T (aj, bj, xj, yj) 

after each trial and re-set T to the constant function 1 for the remaind of the experi 
if 
∏i 

j=1 T (aj, bj, xj, yj) > vthresh. 

3. comput 
∏n 

i=1 T (ai, bi, xi, yi) and abort if thi quantiti do not exceed vthresh. 

4. (extraction) gener a random and uniform d-bit seed string S where d be give by 
eq. s29 with q = 2n, � = �ext/2. output U = ext(ab,s) with the secur guarante 
give by eq. 6. 

after training, we infer an expect valu nµ and varianc nσ2 of 
∑n 

i=1 ln(ti) on the 
remain trial assum i.i.d. trial and gaussian statist accord to the central limit theo- 
rem, where n and µwere calcul accord to the distribut obtain from the optim 
problem of eq. s23. note that under these assumptions, we treat 

∑n 
i=1 ln(ti) a if it be a sum 

of independ and bound rvs. sinc V = exp ( 
∑n 

i=1 ln(ti)) we can then choos vthresh so 
that it have a 0.95 chanc of be exceed accord to the gaussian approximation, by set 
vthresh = e 

nµ−1.645 
√ 
nσ. for data set 3, 4 and 5, vthresh be chosen to be small than thi 

valu to increas the chanc of pass the protocol while still meet desir benchmark 
for extract randomness. 

We now discu our applic of the protocol to data set 5, and then summar the main 
result for all five data set in tabl s4. data set 5 set consist of 60,110,210 trials, roughli 
twice a long a each of the first four data sets. the count for each trial outcom from the 
first 5 × 106 trial be show in tabl s2. the maximum likelihood non-sign distribut 
correspond to these count be show in tabl s3. We determin T from thi distribution, 
the valu of T be show in tabl 1 of the main text. 

tabl s2: result count for the first 5× 106 trial of data set 5. 
ab = ++ ab = +0 ab = 0+ ab = 00 

xy = 00 3166 1851 2043 1243520 
xy = 01 3637 1338 13544 1230633 
xy = 10 3992 13752 1226 1230686 
xy = 11 357 17648 16841 1215766 

the 0.95 rule for determin vthresh give that there be 55,110,210 trial for the protocol 
yield vthresh = 8.79 × 1036. We chose a more conserv valu of vthresh = 1.5 × 1032 to 

17 



tabl s3: maximum likelihood non-sign distribut accord to the count in tabl s2, 
round to eight decim places. 

ab = ++ ab = +0 ab = 0+ ab = 00 
xy = 00 0.00063301 0.00036794 0.00041085 0.24858820 
xy = 01 0.00073159 0.00026936 0.00270824 0.24629081 
xy = 10 0.00080002 0.00277179 0.00024384 0.24618435 
xy = 11 0.00007087 0.00350093 0.00336896 0.24305924 

improv the odd of pass the protocol, while still allow for the extract of 1024 bit 
uniform to within 10−12. thi threshold correspond to a probabl of pass of roughli 
0.9916 accord to the i.i.d. scenario describ above. run the protocol, thi threshold 
be exceeded, with a final valu of V = 2.018× 1041. 

the run product 
∏c 

i=1 Ti first exceed vthresh at trial number c = 41, 243, 976, and 
one have the option of set the remain Ti = 1 regardless of outcom for the rest of the 
data run. the sound of thi procedur be justifi by the adapt properti of the entropi 
product theorem. In our applic of the protocol, we implement a similar strategi 
without technic chang the bell function, by relabel all outcom to 0 start at trial 
number c + 1. thi also result in Ti = 1 for the remaind of the experiment. thi strategi be 
justifi a our assumpt allow for alic and bob to cooper make arbitrari chang to 
the experi in advanc of a trial base on the past, which includ the current run prod- 
uct. turn off the detector to guarante outcom of 0 be one such change, and in principl 
there be suffici time (at least 5µs) for the necessari commun to take place after the 
previou trial. 

throughout, we do not consid the length d of the seed in make our choic and deter- 
mine d from the other paramet accord to eq. s29. for appli the extractor to data 
set 5, we use 315,844 seed bits. the seed bit be collect from one of the random number 
gener use to select the set in [13]. specifically, each seed bit come from the xor 
of two bit gener by the photon-sampl random number gener describ in [13]. It 
take 317 second for our comput to construct the extractor accord to the tmp algorithm 
and gener the explicit final output string. here be the final output string that result from 
appli the extractor to the string ab, when AB be obtain with relabel of all outcom 
to 0 start at trial number 41, 243, 977 (after vthresh be exceed by the run product). 

11100010011111111101001100001111100101010101001101111001111010110101101000011011000111010001101000111010011110011100101101100100 
10111111111001100010110010110111101100101111010011001101101111010100111001011010111111011110010100110001000101011000001111111101 
11011001110001111100010010011100011100000000010110010101101111001011001001000001101110110000000111110111001110001100101110001100 
10110110001100011101001001001010101000100001010101001001011101010101001010100111001101001010001010100001101111110110011011110000 
11100110100110010111001011000110010100101000110101100100000110111000101101001101110110111111001110110011100000001111001111101100 
10110000111110011100110111110110101111000001010001010110100010011101011000001001011100010110101101111100110100001110101110110101 
10001010011111011110111001000001000110111111110011101001110100111000000100101100010011101110100001110101111001001011111111001100 
01111011101001101010101100010010000011111110010101011010111111100011110110001010111011000001111000011111101100100010001001000010 

after the protocol be run, we ran consist check on the data set to look for potenti 
inconsist with eq. 3, the no-sign assumption. use the test describ in ref. [13], 
we examin the four signal equalities: 1: p(a|x = 0, Y ) = p(a|x = 0), 2: p(a|x = 

18 



tabl s4: summari of applic of protocol to data sets. for fix goal choic of �fin, the 
error paramet be comput accord to the formula �p = κ2 = (0.95 �fin)2, �ext = 0.05 �fin. 
error paramet be chosen in advanc of run the protocol for data set 3, 4 and 5; the 
�fin and t valu for data set 1 and 2 be mark with an asterisk a they be not chosen in 
advanc and be onli includ for illustr purposes. We remark that the quantiti 1/vthresh 
can also be interpret a a p-valu against local realism [31]. 

data set n m 95% cut off vthresh �fin t V > vthresh 
1 24865320 0.01066 4.68× 1016 4.68× 1016 10−6∗ 512∗ ye 
2 24809970 0.01126 1.30× 105 1.30× 105 0.01∗ 61∗ ye 
3 24818959 0.01163 9.74× 1019 1017 10−6 512 ye 
4 24846822 0.01063 6.57× 1015 1015 10−6 256 ye 
5 55110210 0.01004 8.79× 1036 1.5× 1032 10−12 1024 ye 

tabl s5: 2-tail p-valu for consist check 
data set sig. 1 sig. 2 sig. 3 sig. 4 

data set 1 0.507 0.777 0.290 0.323 
data set 2 0.765 0.965 0.115 0.684 
data set 3 0.633 0.072 0.381 0.099 
data set 4 0.144 0.320 0.844 0.356 
data set 5 0.879 0.131 0.554 0.885 

1, Y ) = p(a|x = 1), 3: p(b|x, Y = 0) = p(b|i = 0), and 4: p(b|x, Y = 1) = 
p(b|i = 1). for these test we use statist whose asymptot distribut would approach 
the standard normal with mean 0 and varianc 1, if the trial be i.i.d. We report the p-valu 
obtain from these test for all data set in tabl s5, which do not suggest ani inconsistencies. 

prior to the analysi of the five data set report in the main text, the protocol be appli 
to data set take a part of the experi report in ref. [13]. these result be describ 
in [46]. after set asid the first 5 × 107 trial of the data set xor 3 a a train set to 
construct the function T and choos a threshhold vthresh base on the 95% rule, the protocol be 
appli to the rest of the data set with paramet �p = 3.1797× 10−4 and �ext = 3.533× 10−5, 
which be chosen to minim �p/κ + �ext for κ = 1/3 while satisfi eq. 5. thi choic 
of paramet be suboptim for minim either �fin or max(�p + �ext, κ), the two figur 
of merit disucss in the main text. however, the instanc of the tmp algorithm induc 
by the abov choic of paramet would have be induc by other choic of paramet 
that perform good accord to these figur of merit. the same extract be induc by 
�p = 3.6509 × 10−4, �ext = 3.5330 × 10−5, and κ = 4.0042 × 10−4, which lead to a distanc 
of max(�p + �ext, κ) = 4.0042× 10−4 from an ideal protocol for the extract of 256 bits. We 
can also choos �p = 3.370 × 10−4, �ext = 3.533 × 10−5, and κ = 0.0184 to induc the same 
extract with an �fin paramet of 0.0184. 

statist signific set nonuniform be detect for some of the set examin 

19 



in [46]. thi be consist with the find in [13] that a combin of uncontrol envi- 
ronment variabl and the synchron electron introduc small bia in the settings. 
thi effect be not present in the 2017 data sets, which use a reliabl pseudorandom sourc 
for set randomness. As the entropi product theorem can toler small bia in the 
set distribution, we can explor how the protocol would have perform on xor 3 have we 
selected, prior to run the protocol, a nonzero settings-bia paramet α. We note that the 
protocol paramet must be chosen prior to execut a secur protocol, and sinc we do not 
choos a nonzero α in advanc of examin xor 3, we report the follow calcul onli 
a a retrospect diagnostic. In principl it be imposs to measur α through statist test 
of the output of the random number gener that choos the settings, becaus the set 
probabl can appear random, unbiased, and independ even while chang from trial to 
trial within the bound of a potenti larg α. To choos an exampl α to study, we exam- 
ine 95 % confid interv for the individu set probabl from the six data set 
in [13]. the larg absolut differ from 0.5 among the endpoint of these six interv be 
0.000211 for alic and 0.000150 for bob. assum independ between alic and bob (an 
assumpt which be not contradict by our statist tests), we comput the most and least 
like measur configur give thi larg differ from 0.5 for alice’ and bob’ 
set probability, and found that these would be contain in the interv (0.25−α, 0.25+α) 
for α = 0.000181. for thi exampl choic of α, perform the modifi optim problem 
describ in s.3 yield a T function with m = 0.01179, and for thi T function, the expect 
threshold comput accord to the 95 % rule be vthresh = 5.25× 105, if we assum the “worst- 
case” set distribut among the six extrem set distribut that assign probabil- 
iti 0.25 + α to two set configur and 0.25 − α to two other set configurations. 
thi threshold be pass when the protocol be re-run now with thi non-zero α. for �p valu 
of (0.01, 0.001, 0.0001, 0.00001) we get correspond − log2 δ valu of (524, 383, 242, 101), 
which be a moder reduct compar to the correspond valu of (582, 444, 306, 168) 
obtain by the run the protocol with α = 0. alternatively, we can fix �p and studi how 
− log2 δ chang with α. for one particular choic of �p = 3.1797 × 10−4, which be the 
small �p valu consid earli in analysi of xor 3, α valu of (0, 0.00001, 0.0001, 
0.001) yield − log2 δ valu of (367, 366, 321, 94). the larg valu α = 0.001 in thi list may 
be consid a conserv choice: if in the first calcul abov we have use 99.999998 % 
instead of 95 % confid intervals, we would have obtain a valu of α ≈ 0.001/3 instead 
of α = 0.000181. 

s.7 perform of previou protocols. 
other protocol in the literatur could not be use for our data set for variou reasons. mani 
protocol appli to differ measur scenarios. for instance, [4] describ a protocol in- 
volv three separ measur stations, and while [27] provid impress expans 
rate and be secur against quantum side information, it requir eight separ devices. other 
protocol explor quantum side inform in refs. [3, 8, 30] either also appli to differ 

20 



experiment setup or provid onli asymptot secur result a the number of trial n ap- 
proach infinity. the first protocol achiev secur against quantum side inform [6] 
appli to a bipartit experi like our but requir system that achiev per-trial bell vio- 
lation much high than ours. anoth studi [11] of bipartit experi with data regim 
characterist of photon system appli to i.i.d. scenarios. 

the protocol of refs. [5, 29] be applic to our experiment scenario while make 
minim assumptions, and give enough trial could work for ani violat regime. ref. [5] 
obtain protocol for assumpt equival to ours, but consid also the case where the 
distribut be in addit assum to be quantum achievable. ref. [29], which us the 
entropi accumul theorem of ref. [28], obtain protocol assum that the distribut 
be quantum achievable, but allow for quantum side information. however, these protocol 
be ineffect for the number of trial in our data sets, which we illustr with a heurist 
argument. both protocol be base on the clauser-horne-shimony-holt (chsh) bell function 
[47] 

T c(a, b, x, y) = 

 
1 if (x, y) 6= (1, 1) and a = b 
1 if (x, y) = (1, 1) and a 6= b 
0 otherwise. 

(s44) 

the statist T c = n−1 
∑n 

i=1 T 
c 
i use by these protocol for wit accumul violat 

satisfi e(t c) ≤ 0.75 under lr, while e(t c) = 0.75009787 for the distribut in tabl 
s3. the complet predict LR theori that onli produc “00” outcom regardless of the 
set satisfi e(t c) = 0.75, but in an experi of n = 55, 110, 210 trials, thi theori can 
produc a valu of T c exceed 0.75009787 with probabl roughli 0.047. thus, base on 
thi statist alone, we cannot infer the presenc of ani low-error randomness. 

the protocol of ref. [5] (the PM protocol for short, see [2, 7] for amendments), can be 
modifi to work with ani bell function, and there be method for obtain good bell func- 
tion [9, 10] or simultan use a suit of bell function [48]. here, we demonstr that 
for ani choic of bell function, the method of [5] a refin in [2] cannot be expect to effec- 
tive certifi ani random from an experi distribut accord to tabl S3 unless the 
number of trial exce 1.56× 108, which be larg than the number of trial in our data runs. 

for the most inform comparison to our protocol, we consid the PM protocol without 
their addit constraint that the distribut be induc by a quantum state. To deriv a bound 
on the perform of the PM protocol, we refer to theorem 1 of [2]. thi theorem involv 
a choic of bell function denot by I (analog to our T ), a threshold Jm (analog to our 
vthresh) to be exceed by the bell estim Ī = n−1 

∑n 
i=1 ii, and a function f that we discu 

below. To be abl to extract some randomness, the theorem requir that 

nf(jm − µ) > 0. (s45) 

the paramet µ be give by (imax + ins) 
√ 

(2/n) ln(1/�) where imax be the larg valu in the 
rang of the bell function I , in ≤ imax be the larg possibl expect valu of I for non- 
signal distributions, and 0 < � ≤ 1 be a free paramet that be add to the TV distanc 

21 



from uniform for the final output string. smaller choic of �, which be analog to our �p, be 
desir but requir larg n for the constraint eq. s45 to be posit a we will see below. We 
also note that eq. s45 be a necessari but not suffici condit for extract randomness; in 
particular, we ignor the neg contribut from the paramet �′ of [2] (somewhat analog 
to the paramet κ in the statement of the protocol sound theorem in s.5) a well a ani 
error introduc in the extract step. 

for eq. s45, we can without loss of gener consid onli bell function for which 0 ≤ 
IL < in ≤ imax, where IL be the maximum expect of I for LR distributions. further, 
becaus the relev quantiti below be invari when the bell function be rescaled, we can 
assum IL = 1. accord to ref. [2]’ eq. 8 and the follow paragraph, we can write 
f(x) = − log2(g(x)), where g be monoton decreas and concave, and satisfi 

max 
ab 

p(ab|xy) ≤ g(e(i)p) (s46) 

for all xy and non-sign distribut P. (recal that we be not use the strong constraint 
that P be induc by a quantum state.) accord to eq. s15 we can defin g(x) = 1 + (1 − 
x)/(2(in − 1)). later we argu that thi definit of g cannot be improved. substitut into 
eq. s45 we get the inequ 

−n log2 

1 + 1− Jm + (imax + ins) 
√ 

2 
n 

ln 1 
� 

2(in − 1) 

 > 0. (s47) 
sinc 2(in − 1) be positive, thi be equival to√ 

2 

n 
ln 

1 

� 
< 

Jm − 1 
imax + in 

. (s48) 

note that imax + in ≥ 2ins, thi implies√ 
2 

n 
ln 

1 

� 
< 
Jm − 1 

2in 
. (s49) 

thus, the number of trial need to extract random by the PM protocol be bound below 
accord to 

n > 8 
ln(1/�)i2n 
(jm − 1)2 

. (s50) 

for a give anticip experiment distribut pant, Jm be best chosen to be at most e(i)p . 
otherwise, the probabl that Ī exce Jm be small. however, for the maximum amount of 
extract randomness, Jm should be close to e(i)p . consid the infer distribut from 
the first 5× 106 trial of data set 5. By follow the procedur give in section 2 of [39], we 
can write thi distribut a a convex combin of a PR box with weight p = 3.915× 10−4 

22 



and an LR distribut with weight 1 − p. from thi we see that one should choos Jm ≤ 
e(i)p = pin + (1 − p) ≤ pin + 1. substitut into eq. s50 and use � ≤ 0.05 (a rather 
high bound on the allow TV distanc from uniform) give 

n > 8 
ln(1/�) 

p2 
≥ 1.56× 108, (s51) 

which be alreadi more than twice the number of trial use to gener random in data 
set 5. for small error valu compar to the one we report, thi bound onli increases: 
achiev � = 10−12 would requir at least 1.44× 109 trials. 

To finish our argument that the PM protocol cannot improv on thi bound under our as- 
sumptions, consid the definit of g. If we could find a function g′ ≤ g with g′(x) < g(x) 
for some x ∈ (1, ins], then f = − log2(g′) might yield a small low bound on n. note that 
for x ≤ 1, g′(x) ≥ g′(1) and g′(1) must be at least 1 because, refer to eq. s46, there be a 
condit determinist LR distribut P satisfi e(i)p = 1 and maxab p(ab|xy) = 1. 
henc eq. s45 cannot be satisfi for argument x of f(x) = − log2(g′(x)) with x ≤ 1. given 
x ∈ (1, ins], write x = (1 − p) + pins. let Q be the PR box achiev e(i)q = in and 
Q′ a condit determinist LR theori achiev e(i)q′ = 1. then e(i)(1−p)q′+pq′ = x. 
furthermore, there be a set xy at which the LR theory’ outcom be insid the support of the 
PR box’ outcomes. To see this, by symmetri it suffic to consid the PR box of eq. s13. it 
outcom be opposit at set 11 and ident at the other three. A determinist LR theory’ 
outcom be opposit at an even number of settings, so either it be opposit at set 11, or it be 
ident at one of the others. for set xy, the bound in eq. s46 be achiev for our definit 
of g. henc ani other valid replac g′ for g must satisfi g′(x) ≥ g(x) for x ∈ (1, ins], and 
so eq. s45 with f(x) = − log2(g′(x)) impli eq. s45 with f(x) = − log2(g(x)). thu the 
low bound on n deriv abov will appli to g′ a well. 

refer 
[35] levin, D. a., peres, Y. & wilmer, E. L. markov chain and mix time (american 

mathemat soc., 2009). 

[36] pardo, M. & vajda, I. about distanc of discret distribut satisfi the data process- 
ing theorem of inform theory. ieee transact on inform theori 43, 1288–1293 
(1997). 

[37] popescu, S. & rohrlich, D. quantum nonloc a an axiom. found. phys. 24, 379–85 
(1994). 

[38] barrrett, J. et al. nonloc correl a an information-theoret resource. phys. rev. A 
71, 022101 (2005). 

23 



[39] bierhorst, P. geometr decomposit of bell polytop with practic applications. J. 
phys. A: math. theor. 49, 215301 (2016). 

[40] shafer, g., shen, a., vereshchagin, N. & vovk, V. test martingales, bay factor and 
p-values. statist scienc 26, 84–101 (2011). 

[41] vadhan, S. P. pseudorandomness, vol. 7 of foundat and trend in theoret com- 
puter scienc (2012). 

[42] ma, x., zhang, Z. & tan, X. explicit combinatori design (2012). arxiv:1109.6147v2 
[math.co]. 

[43] kessler, M. & arnon-friedman, R. device-independ random amplif and 
privat (2017). arxiv:1705.04148 [quant-ph]. 

[44] könig, R. & terhal, B. the bounded-storag model in the presenc of a quantum adver- 
sary. ieee T. inform. theori 54, 749–62 (2008). 

[45] portmann, C. & renner, R. cryptograph secur of quantum key distribut (2014). 
arxiv:1409.3525 [quant-ph]. 

[46] bierhorst, P. et al. experiment gener random number certifi by the impossibil- 
iti of superlumin signal (2017). arxiv:1702.05178 [quant-ph]. 

[47] clauser, j., horne, a., shimony, A. & holt, R. propos experi to test local hidden- 
variabl theories. phys. rev. lett. 23, 880–884 (1969). 

[48] nieto-silleras, o., bamps, c., silman, J. & pironio, S. device-independ random 
gener from sever bell estim (2016). arxiv:1611.00352 [quant-ph]. 

24 


s.1 preliminari 
s.2 proof of the entropi product theorem 
s.3 choos the bell function T 
s.4 the tmp algorithm 
s.5 proof of the protocol sound theorem 
s.6 protocol applic detail 
s.7 perform of previou protocols. 

